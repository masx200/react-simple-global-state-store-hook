{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nexport function useGlobalStore(name: string): [any, Dispatch] {\n    return useGlobalStoreold({ [name]: \"\" })[name];\n}\ntype Dispatch = (value: any) => void;\nfunction isfunction(a: any): a is Function {\n    return \"function\" === typeof a;\n}\nexport function changeState(keyname: string, newvalue: any) {\n    const key = keyname;\n    const eventname = key;\n    let newstate = newvalue;\n    const oldstate = simpleglobalstatestore[key];\n    const state = oldstate;\n    if (isfunction(newstate)) {\n        newstate = newstate.call(undefined, state);\n    }\n    if (isinvalidstate(newstate)) {\n        throw Error(\"invalid state\");\n    }\n    if (!jsondeepequal(newstate, state)) {\n        simpleglobalstatestore[key] = jsonparsestringify(newstate);\n        console.log(\"全局状态改变\", simpleglobalstatestore);\n        temptarget.dispatchEvent(new Event(eventname));\n    }\n}\n\"use strict\";\nfunction jsonparsestringify(o: { [key: string]: any }): { [key: string]: any } {\n    return JSON.parse(JSON.stringify(o));\n}\nexport function getGlobalStates(name: string) {\n    return newobjjson(simpleglobalstatestore)[name];\n}\n\nfunction jsondeepequal(a: any, b: any) {\n    return JSON.stringify(a) === JSON.stringify(b);\n}\nfunction isinvalidstate(newstate: any) {\n    return (\n        \"undefined\" === typeof newstate ||\n        isfunction(newstate) ||\n        newstate === null ||\n        \"symbol\" === typeof newstate\n    );\n}\nconst temptarget = new EventTarget();\nconst simpleglobalstatestore: { [key: string]: any } = {};\nfunction newobjjson(obj: { [key: string]: any }): { [key: string]: any } {\n    if (typeof obj !== \"object\") {\n        throw new TypeError(\"The argument passed in must be an 'object' type!\");\n    }\n    return jsonparsestringify(obj);\n}\nfunction isplainobject(o: any) {\n    return (\n        typeof o === \"object\" &&\n        Object.prototype.toString.call(o) === \"[object Object]\"\n    );\n}\nfunction useGlobalStoreold(jsonobject: {\n    [key: string]: any;\n}): { [key: string]: [any, Dispatch] } {\n    if (!isplainobject(jsonobject)) {\n        throw Error(\"invalid object\");\n    }\n    const newjsonobj = newobjjson(jsonobject);\n    const newobjtoreturn: { [key: string]: [any, Dispatch] } = {};\n    Object.keys(newjsonobj).forEach((key) => {\n        const eventname = key;\n        if (\"undefined\" === typeof simpleglobalstatestore[key]) {\n            simpleglobalstatestore[key] = newjsonobj[key];\n        }\n        const initialstate =\n            \"undefined\" !== typeof simpleglobalstatestore[key]\n                ? simpleglobalstatestore[key]\n                : newjsonobj[key];\n        if (isinvalidstate(initialstate)) {\n            throw Error(\"invalid state\");\n        }\n        const [state, setstate] = useState(jsonparsestringify(initialstate));\n        const eventhandler = useCallback(() => {\n            const newstate = simpleglobalstatestore[key];\n            if (!jsondeepequal(newstate, state))\n                setstate(jsonparsestringify(newstate));\n        }, []);\n        useEffect(() => {\n            temptarget.addEventListener(eventname, eventhandler);\n            temptarget.dispatchEvent(new Event(eventname));\n            return () => {\n                temptarget.removeEventListener(eventname, eventhandler);\n            };\n        }, []);\n        newobjtoreturn[key] = [\n            state,\n            (newstate: any) => {\n                if (isfunction(newstate)) {\n                    newstate = newstate.call(undefined, state);\n                }\n                if (isinvalidstate(newstate)) {\n                    throw Error(\"invalid state\");\n                }\n                if (!jsondeepequal(newstate, state)) {\n                    simpleglobalstatestore[key] = jsonparsestringify(newstate);\n                    console.log(\"全局状态改变\", simpleglobalstatestore);\n                    temptarget.dispatchEvent(new Event(eventname));\n                }\n            },\n        ];\n    });\n    return newobjtoreturn;\n}\nexport function initGlobalState(jsonobject: { [key: string]: any }) {\n    if (!isplainobject(jsonobject)) {\n        throw Error(\"invalid object\");\n    }\n    const newjsonobj = newobjjson(jsonobject);\n    const newobjtoreturn: { [key: string]: any } = {};\n    Object.keys(newjsonobj).forEach((key) => {\n        if (\"undefined\" === typeof simpleglobalstatestore[key]) {\n            simpleglobalstatestore[key] = newjsonobj[key];\n        }\n        newobjtoreturn[key] = simpleglobalstatestore[key];\n    });\n    console.log(\"全局状态生成\", simpleglobalstatestore);\n    return newobjtoreturn;\n}\n"],"names":["useGlobalStore","name","useGlobalStoreold","[object Object]","isfunction","a","changeState","keyname","newvalue","key","eventname","newstate","oldstate","simpleglobalstatestore","state","call","undefined","isinvalidstate","Error","jsondeepequal","jsonparsestringify","console","log","temptarget","dispatchEvent","Event","o","JSON","parse","stringify","getGlobalStates","newobjjson","b","EventTarget","obj","TypeError","isplainobject","Object","prototype","toString","jsonobject","newjsonobj","newobjtoreturn","keys","forEach","initialstate","setstate","useState","eventhandler","useCallback","useEffect","addEventListener","removeEventListener","initGlobalState"],"mappings":"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"}