{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\r\nexport function useGlobalStore(name: string): [any, Function] {\r\n  return useGlobalStoreold({ [name]: \"\" })[name];\r\n}\r\nfunction isfunction(a: any): a is Function {\r\n  return \"function\" === typeof a;\r\n}\r\nexport function changeState(keyname: string, newvalue: any) {\r\n  const key = keyname;\r\n  const eventname = key;\r\n  let newstate = newvalue;\r\n  const oldstate = simpleglobalstatestore[key];\r\n  const state = oldstate;\r\n  if (isfunction(newstate)) {\r\n    newstate = newstate.call(undefined, state);\r\n  }\r\n  if (isinvalidstate(newstate)) {\r\n    throw Error(\"invalid state\");\r\n  }\r\n  if (!jsondeepequal(newstate, state)) {\r\n    simpleglobalstatestore[key] = jsonparsestringify(newstate);\r\n    console.log(\"全局状态改变\", simpleglobalstatestore);\r\n    temptarget.dispatchEvent(new Event(eventname));\r\n  }\r\n}\r\n\"use strict\";\r\nfunction jsonparsestringify(o: { [key: string]: any }): { [key: string]: any } {\r\n  return JSON.parse(JSON.stringify(o));\r\n}\r\nexport function getGlobalStates() {\r\n  return newobjjson(simpleglobalstatestore);\r\n}\r\n\r\nfunction jsondeepequal(a: any, b: any) {\r\n  return JSON.stringify(a) === JSON.stringify(b);\r\n}\r\nfunction isinvalidstate(newstate: any) {\r\n  return (\r\n    \"undefined\" === typeof newstate ||\r\n    isfunction(newstate) ||\r\n    newstate === null ||\r\n    \"symbol\" === typeof newstate\r\n  );\r\n}\r\nconst temptarget = new EventTarget();\r\nconst simpleglobalstatestore: { [key: string]: any } = {};\r\nfunction newobjjson(obj: { [key: string]: any }): { [key: string]: any } {\r\n  if (typeof obj !== \"object\") {\r\n    throw new TypeError(\"The argument passed in must be an 'object' type!\");\r\n  }\r\n  return jsonparsestringify(obj);\r\n}\r\nfunction isplainobject(o: any) {\r\n  return (\r\n    typeof o === \"object\" &&\r\n    Object.prototype.toString.call(o) === \"[object Object]\"\r\n  );\r\n}\r\nfunction useGlobalStoreold(jsonobject: {\r\n  [key: string]: any;\r\n}): { [key: string]: [any, Function] } {\r\n  if (!isplainobject(jsonobject)) {\r\n    throw Error(\"invalid object\");\r\n  }\r\n  const newjsonobj = newobjjson(jsonobject);\r\n  const newobjtoreturn: { [key: string]: [any, Function] } = {};\r\n  Object.keys(newjsonobj).forEach(key => {\r\n    const eventname = key;\r\n    if (\"undefined\" === typeof simpleglobalstatestore[key]) {\r\n      simpleglobalstatestore[key] = newjsonobj[key];\r\n    }\r\n    const initialstate =\r\n      \"undefined\" !== typeof simpleglobalstatestore[key]\r\n        ? simpleglobalstatestore[key]\r\n        : newjsonobj[key];\r\n    if (isinvalidstate(initialstate)) {\r\n      throw Error(\"invalid state\");\r\n    }\r\n    const [state, setstate] = useState(jsonparsestringify(initialstate));\r\n    const eventhandler = useCallback(() => {\r\n      const newstate = simpleglobalstatestore[key];\r\n      if (!jsondeepequal(newstate, state))\r\n        setstate(jsonparsestringify(newstate));\r\n    }, []);\r\n    useEffect(() => {\r\n      temptarget.addEventListener(eventname, eventhandler);\r\n      temptarget.dispatchEvent(new Event(eventname));\r\n      return () => {\r\n        temptarget.removeEventListener(eventname, eventhandler);\r\n      };\r\n    }, []);\r\n    newobjtoreturn[key] = [\r\n      state,\r\n      (newstate: any) => {\r\n        if (isfunction(newstate)) {\r\n          newstate = newstate.call(undefined, state);\r\n        }\r\n        if (isinvalidstate(newstate)) {\r\n          throw Error(\"invalid state\");\r\n        }\r\n        if (!jsondeepequal(newstate, state)) {\r\n          simpleglobalstatestore[key] = jsonparsestringify(newstate);\r\n          console.log(\"全局状态改变\", simpleglobalstatestore);\r\n          temptarget.dispatchEvent(new Event(eventname));\r\n        }\r\n      }\r\n    ];\r\n  });\r\n  return newobjtoreturn;\r\n}\r\nexport function initGlobalState(jsonobject: { [key: string]: any }) {\r\n  if (!isplainobject(jsonobject)) {\r\n    throw Error(\"invalid object\");\r\n  }\r\n  const newjsonobj = newobjjson(jsonobject);\r\n  const newobjtoreturn: { [key: string]: any } = {};\r\n  Object.keys(newjsonobj).forEach(key => {\r\n    if (\"undefined\" === typeof simpleglobalstatestore[key]) {\r\n      simpleglobalstatestore[key] = newjsonobj[key];\r\n    }\r\n    newobjtoreturn[key] = simpleglobalstatestore[key];\r\n  });\r\n  console.log(\"全局状态生成\", simpleglobalstatestore);\r\n  return newobjtoreturn;\r\n}\r\n"],"names":["useGlobalStore","name","useGlobalStoreold","[object Object]","isfunction","a","changeState","keyname","newvalue","key","eventname","newstate","oldstate","simpleglobalstatestore","state","call","undefined","isinvalidstate","Error","jsondeepequal","jsonparsestringify","console","log","temptarget","dispatchEvent","Event","o","JSON","parse","stringify","getGlobalStates","newobjjson","b","EventTarget","obj","TypeError","isplainobject","Object","prototype","toString","jsonobject","newjsonobj","newobjtoreturn","keys","forEach","initialstate","setstate","useState","eventhandler","useCallback","useEffect","addEventListener","removeEventListener","initGlobalState"],"mappings":";;SACgBA,eAAeC;IAC7B,OAAOC,kBAAkB;QAAEC,CAACF,OAAO;OAAMA;;;AAE3C,SAASG,WAAWC;IAClB,OAAO,sBAAsBA;;;SAEfC,YAAYC,SAAiBC;IAC3C,MAAMC,MAAMF;IACZ,MAAMG,YAAYD;IAClB,IAAIE,WAAWH;IACf,MAAMI,WAAWC,uBAAuBJ;IACxC,MAAMK,QAAQF;IACd,IAAIR,WAAWO,WAAW;QACxBA,WAAWA,SAASI,KAAKC,WAAWF;;IAEtC,IAAIG,eAAeN,WAAW;QAC5B,MAAMO,MAAM;;IAEd,KAAKC,cAAcR,UAAUG,QAAQ;QACnCD,uBAAuBJ,OAAOW,mBAAmBT;QACjDU,QAAQC,IAAI,wCAAUT;QACtBU,WAAWC,cAAc,IAAIC,MAAMf;;;;AAIvC,SAASU,mBAAmBM;IAC1B,OAAOC,KAAKC,MAAMD,KAAKE,UAAUH;;;AAEnC,SAAgBI;IACd,OAAOC,WAAWlB;;;AAGpB,SAASM,cAAcd,GAAQ2B;IAC7B,OAAOL,KAAKE,UAAUxB,OAAOsB,KAAKE,UAAUG;;;AAE9C,SAASf,eAAeN;IACtB,OACE,uBAAuBA,YACvBP,WAAWO,aACXA,aAAa,QACb,oBAAoBA;;;AAGxB,MAAMY,aAAa,IAAIU;;AACvB,MAAMpB,yBAAiD;;AACvD,SAASkB,WAAWG;IAClB,WAAWA,QAAQ,UAAU;QAC3B,MAAM,IAAIC,UAAU;;IAEtB,OAAOf,mBAAmBc;;;AAE5B,SAASE,cAAcV;IACrB,cACSA,MAAM,YACbW,OAAOC,UAAUC,SAASxB,KAAKW,OAAO;;;AAG1C,SAASxB,kBAAkBsC;IAGzB,KAAKJ,cAAcI,aAAa;QAC9B,MAAMtB,MAAM;;IAEd,MAAMuB,aAAaV,WAAWS;IAC9B,MAAME,iBAAqD;IAC3DL,OAAOM,KAAKF,YAAYG,QAAQnC;QAC9B,MAAMC,YAAYD;QAClB,IAAI,uBAAuBI,uBAAuBJ,MAAM;YACtDI,uBAAuBJ,OAAOgC,WAAWhC;;QAE3C,MAAMoC,eACJ,uBAAuBhC,uBAAuBJ,OAC1CI,uBAAuBJ,OACvBgC,WAAWhC;QACjB,IAAIQ,eAAe4B,eAAe;YAChC,MAAM3B,MAAM;;QAEd,OAAOJ,OAAOgC,YAAYC,SAAS3B,mBAAmByB;QACtD,MAAMG,eAAeC,YAAY;YAC/B,MAAMtC,WAAWE,uBAAuBJ;YACxC,KAAKU,cAAcR,UAAUG,QAC3BgC,SAAS1B,mBAAmBT;WAC7B;QACHuC,UAAU;YACR3B,WAAW4B,iBAAiBzC,WAAWsC;YACvCzB,WAAWC,cAAc,IAAIC,MAAMf;YACnC,OAAO;gBACLa,WAAW6B,oBAAoB1C,WAAWsC;;WAE3C;QACHN,eAAejC,OAAO,EACpBK,OACCH;YACC,IAAIP,WAAWO,WAAW;gBACxBA,WAAWA,SAASI,KAAKC,WAAWF;;YAEtC,IAAIG,eAAeN,WAAW;gBAC5B,MAAMO,MAAM;;YAEd,KAAKC,cAAcR,UAAUG,QAAQ;gBACnCD,uBAAuBJ,OAAOW,mBAAmBT;gBACjDU,QAAQC,IAAI,wCAAUT;gBACtBU,WAAWC,cAAc,IAAIC,MAAMf;;;;IAK3C,OAAOgC;;;SAEOW,gBAAgBb;IAC9B,KAAKJ,cAAcI,aAAa;QAC9B,MAAMtB,MAAM;;IAEd,MAAMuB,aAAaV,WAAWS;IAC9B,MAAME,iBAAyC;IAC/CL,OAAOM,KAAKF,YAAYG,QAAQnC;QAC9B,IAAI,uBAAuBI,uBAAuBJ,MAAM;YACtDI,uBAAuBJ,OAAOgC,WAAWhC;;QAE3CiC,eAAejC,OAAOI,uBAAuBJ;;IAE/CY,QAAQC,IAAI,wCAAUT;IACtB,OAAO6B;;;"}