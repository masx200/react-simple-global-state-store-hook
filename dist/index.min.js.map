{"version":3,"file":"index.min.js","sources":["../src/index.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\r\nexport function useGlobalStore(name: string): [any, Dispatch] {\r\n  return useGlobalStoreold({ [name]: \"\" })[name];\r\n}\r\ntype Dispatch = (value: any) => void;\r\nfunction isfunction(a: any): a is Function {\r\n  return \"function\" === typeof a;\r\n}\r\nexport function changeState(keyname: string, newvalue: any) {\r\n  const key = keyname;\r\n  const eventname = key;\r\n  let newstate = newvalue;\r\n  const oldstate = simpleglobalstatestore[key];\r\n  const state = oldstate;\r\n  if (isfunction(newstate)) {\r\n    newstate = newstate.call(undefined, state);\r\n  }\r\n  if (isinvalidstate(newstate)) {\r\n    throw Error(\"invalid state\");\r\n  }\r\n  if (!jsondeepequal(newstate, state)) {\r\n    simpleglobalstatestore[key] = jsonparsestringify(newstate);\r\n    console.log(\"全局状态改变\", simpleglobalstatestore);\r\n    temptarget.dispatchEvent(new Event(eventname));\r\n  }\r\n}\r\n\"use strict\";\r\nfunction jsonparsestringify(o: { [key: string]: any }): { [key: string]: any } {\r\n  return JSON.parse(JSON.stringify(o));\r\n}\r\nexport function getGlobalStates() {\r\n  return newobjjson(simpleglobalstatestore);\r\n}\r\n\r\nfunction jsondeepequal(a: any, b: any) {\r\n  return JSON.stringify(a) === JSON.stringify(b);\r\n}\r\nfunction isinvalidstate(newstate: any) {\r\n  return (\r\n    \"undefined\" === typeof newstate ||\r\n    isfunction(newstate) ||\r\n    newstate === null ||\r\n    \"symbol\" === typeof newstate\r\n  );\r\n}\r\nconst temptarget = new EventTarget();\r\nconst simpleglobalstatestore: { [key: string]: any } = {};\r\nfunction newobjjson(obj: { [key: string]: any }): { [key: string]: any } {\r\n  if (typeof obj !== \"object\") {\r\n    throw new TypeError(\"The argument passed in must be an 'object' type!\");\r\n  }\r\n  return jsonparsestringify(obj);\r\n}\r\nfunction isplainobject(o: any) {\r\n  return (\r\n    typeof o === \"object\" &&\r\n    Object.prototype.toString.call(o) === \"[object Object]\"\r\n  );\r\n}\r\nfunction useGlobalStoreold(jsonobject: {\r\n  [key: string]: any;\r\n}): { [key: string]: [any, Dispatch] } {\r\n  if (!isplainobject(jsonobject)) {\r\n    throw Error(\"invalid object\");\r\n  }\r\n  const newjsonobj = newobjjson(jsonobject);\r\n  const newobjtoreturn: { [key: string]: [any, Dispatch] } = {};\r\n  Object.keys(newjsonobj).forEach(key => {\r\n    const eventname = key;\r\n    if (\"undefined\" === typeof simpleglobalstatestore[key]) {\r\n      simpleglobalstatestore[key] = newjsonobj[key];\r\n    }\r\n    const initialstate =\r\n      \"undefined\" !== typeof simpleglobalstatestore[key]\r\n        ? simpleglobalstatestore[key]\r\n        : newjsonobj[key];\r\n    if (isinvalidstate(initialstate)) {\r\n      throw Error(\"invalid state\");\r\n    }\r\n    const [state, setstate] = useState(jsonparsestringify(initialstate));\r\n    const eventhandler = useCallback(() => {\r\n      const newstate = simpleglobalstatestore[key];\r\n      if (!jsondeepequal(newstate, state))\r\n        setstate(jsonparsestringify(newstate));\r\n    }, []);\r\n    useEffect(() => {\r\n      temptarget.addEventListener(eventname, eventhandler);\r\n      temptarget.dispatchEvent(new Event(eventname));\r\n      return () => {\r\n        temptarget.removeEventListener(eventname, eventhandler);\r\n      };\r\n    }, []);\r\n    newobjtoreturn[key] = [\r\n      state,\r\n      (newstate: any) => {\r\n        if (isfunction(newstate)) {\r\n          newstate = newstate.call(undefined, state);\r\n        }\r\n        if (isinvalidstate(newstate)) {\r\n          throw Error(\"invalid state\");\r\n        }\r\n        if (!jsondeepequal(newstate, state)) {\r\n          simpleglobalstatestore[key] = jsonparsestringify(newstate);\r\n          console.log(\"全局状态改变\", simpleglobalstatestore);\r\n          temptarget.dispatchEvent(new Event(eventname));\r\n        }\r\n      }\r\n    ];\r\n  });\r\n  return newobjtoreturn;\r\n}\r\nexport function initGlobalState(jsonobject: { [key: string]: any }) {\r\n  if (!isplainobject(jsonobject)) {\r\n    throw Error(\"invalid object\");\r\n  }\r\n  const newjsonobj = newobjjson(jsonobject);\r\n  const newobjtoreturn: { [key: string]: any } = {};\r\n  Object.keys(newjsonobj).forEach(key => {\r\n    if (\"undefined\" === typeof simpleglobalstatestore[key]) {\r\n      simpleglobalstatestore[key] = newjsonobj[key];\r\n    }\r\n    newobjtoreturn[key] = simpleglobalstatestore[key];\r\n  });\r\n  console.log(\"全局状态生成\", simpleglobalstatestore);\r\n  return newobjtoreturn;\r\n}\r\n"],"names":["useGlobalStore","name","jsonobject","isplainobject","Error","newjsonobj","newobjjson","newobjtoreturn","Object","keys","forEach","key","eventname","simpleglobalstatestore","initialstate","isinvalidstate","state","setstate","useState","jsonparsestringify","eventhandler","useCallback","newstate","jsondeepequal","useEffect","temptarget","addEventListener","dispatchEvent","Event","removeEventListener","isfunction","call","undefined","useGlobalStoreold","[object Object]","a","changeState","keyname","newvalue","o","JSON","parse","stringify","getGlobalStates","b","EventTarget","obj","TypeError","prototype","toString","initGlobalState"],"mappings":"0EACgBA,EAAeC,GAC7B,OAyDF,SAA2BC,GAGzB,IAAKC,EAAcD,GACjB,MAAME,MAAM,kBAEd,MAAMC,EAAaC,EAAWJ,GACxBK,EAAqD,GA2C3D,OA1CAC,OAAOC,KAAKJ,GAAYK,QAAQC,IAC9B,MAAMC,EAAYD,OACd,IAAuBE,EAAuBF,KAChDE,EAAuBF,GAAON,EAAWM,IAE3C,MAAMG,OACJ,IAAuBD,EAAuBF,GAC1CE,EAAuBF,GACvBN,EAAWM,GACjB,GAAII,EAAeD,GACjB,MAAMV,MAAM,iBAEd,MAAOY,EAAOC,GAAYC,EAASC,EAAmBL,IAChDM,EAAeC,EAAY,KAC/B,MAAMC,EAAWT,EAAuBF,GACnCY,EAAcD,EAAUN,IAC3BC,EAASE,EAAmBG,KAC7B,IACHE,EAAU,KACRC,EAAWC,iBAAiBd,EAAWQ,GACvCK,EAAWE,cAAc,IAAIC,MAAMhB,IAC5B,KACLa,EAAWI,oBAAoBjB,EAAWQ,KAE3C,IACHb,EAAeI,GAAO,CACpBK,EACCM,IAIC,GAHIQ,EAAWR,KACbA,EAAWA,EAASS,UAAKC,EAAWhB,IAElCD,EAAeO,GACjB,MAAMlB,MAAM,iBAETmB,EAAcD,EAAUN,KAC3BH,EAAuBF,GAAOQ,EAAmBG,GAEjDG,EAAWE,cAAc,IAAIC,MAAMhB,SAKpCL,EA3GA0B,CAAkB,CAAEC,CAACjC,GAAO,KAAMA,GAG3C,SAAS6B,EAAWK,GAClB,MAAO,mBAAsBA,WAEfC,EAAYC,EAAiBC,GAC3C,MAAM3B,EAAM0B,EACNzB,EAAYD,EAClB,IAAIW,EAAWgB,EACf,MACMtB,EADWH,EAAuBF,GAKxC,GAHImB,EAAWR,KACbA,EAAWA,EAASS,UAAKC,EAAWhB,IAElCD,EAAeO,GACjB,MAAMlB,MAAM,iBAETmB,EAAcD,EAAUN,KAC3BH,EAAuBF,GAAOQ,EAAmBG,GAEjDG,EAAWE,cAAc,IAAIC,MAAMhB,KAIvC,SAASO,EAAmBoB,GAC1B,OAAOC,KAAKC,MAAMD,KAAKE,UAAUH,IAEnC,SAAgBI,IACd,OAAOrC,EAAWO,GAGpB,SAASU,EAAcY,EAAQS,GAC7B,OAAOJ,KAAKE,UAAUP,KAAOK,KAAKE,UAAUE,GAE9C,SAAS7B,EAAeO,GACtB,YACE,IAAuBA,GACvBQ,EAAWR,IACE,OAAbA,GACA,iBAAoBA,EAGxB,MAAMG,EAAa,IAAIoB,YACjBhC,EAAiD,GACvD,SAASP,EAAWwC,GAClB,GAAmB,iBAARA,EACT,MAAM,IAAIC,UAAU,oDAEtB,OAAO5B,EAAmB2B,GAE5B,SAAS3C,EAAcoC,GACrB,MACe,iBAANA,GAC+B,oBAAtC/B,OAAOwC,UAAUC,SAASlB,KAAKQ,YAuDnBW,EAAgBhD,GAC9B,IAAKC,EAAcD,GACjB,MAAME,MAAM,kBAEd,MAAMC,EAAaC,EAAWJ,GACxBK,EAAyC,GAQ/C,OAPAC,OAAOC,KAAKJ,GAAYK,QAAQC,SAC1B,IAAuBE,EAAuBF,KAChDE,EAAuBF,GAAON,EAAWM,IAE3CJ,EAAeI,GAAOE,EAAuBF,KAGxCJ"}