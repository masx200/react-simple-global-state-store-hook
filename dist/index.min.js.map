{"version":3,"file":"index.min.js","sources":["../src/index.ts"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nexport function useGlobalStore(name: string): [any, Dispatch] {\n    return useGlobalStoreold({ [name]: \"\" })[name];\n}\ntype Dispatch = (value: any) => void;\nfunction isfunction(a: any): a is Function {\n    return \"function\" === typeof a;\n}\nexport function changeState(keyname: string, newvalue: any) {\n    const key = keyname;\n    const eventname = key;\n    let newstate = newvalue;\n    const oldstate = simpleglobalstatestore[key];\n    const state = oldstate;\n    if (isfunction(newstate)) {\n        newstate = newstate.call(undefined, state);\n    }\n    if (isinvalidstate(newstate)) {\n        throw Error(\"invalid state\");\n    }\n    if (!jsondeepequal(newstate, state)) {\n        simpleglobalstatestore[key] = jsonparsestringify(newstate);\n        console.log(\"全局状态改变\", simpleglobalstatestore);\n        temptarget.dispatchEvent(new Event(eventname));\n    }\n}\n\"use strict\";\nfunction jsonparsestringify(o: { [key: string]: any }): { [key: string]: any } {\n    return JSON.parse(JSON.stringify(o));\n}\nexport function getGlobalStates(name: string) {\n    return newobjjson(simpleglobalstatestore)[name];\n}\n\nfunction jsondeepequal(a: any, b: any) {\n    return JSON.stringify(a) === JSON.stringify(b);\n}\nfunction isinvalidstate(newstate: any) {\n    return (\n        \"undefined\" === typeof newstate ||\n        isfunction(newstate) ||\n        newstate === null ||\n        \"symbol\" === typeof newstate\n    );\n}\nconst temptarget = new EventTarget();\nconst simpleglobalstatestore: { [key: string]: any } = {};\nfunction newobjjson(obj: { [key: string]: any }): { [key: string]: any } {\n    if (typeof obj !== \"object\") {\n        throw new TypeError(\"The argument passed in must be an 'object' type!\");\n    }\n    return jsonparsestringify(obj);\n}\nfunction isplainobject(o: any) {\n    return (\n        typeof o === \"object\" &&\n        Object.prototype.toString.call(o) === \"[object Object]\"\n    );\n}\nfunction useGlobalStoreold(jsonobject: {\n    [key: string]: any;\n}): { [key: string]: [any, Dispatch] } {\n    if (!isplainobject(jsonobject)) {\n        throw Error(\"invalid object\");\n    }\n    const newjsonobj = newobjjson(jsonobject);\n    const newobjtoreturn: { [key: string]: [any, Dispatch] } = {};\n    Object.keys(newjsonobj).forEach((key) => {\n        const eventname = key;\n        if (\"undefined\" === typeof simpleglobalstatestore[key]) {\n            simpleglobalstatestore[key] = newjsonobj[key];\n        }\n        const initialstate =\n            \"undefined\" !== typeof simpleglobalstatestore[key]\n                ? simpleglobalstatestore[key]\n                : newjsonobj[key];\n        if (isinvalidstate(initialstate)) {\n            throw Error(\"invalid state\");\n        }\n        const [state, setstate] = useState(jsonparsestringify(initialstate));\n        const eventhandler = useCallback(() => {\n            const newstate = simpleglobalstatestore[key];\n            if (!jsondeepequal(newstate, state))\n                setstate(jsonparsestringify(newstate));\n        }, []);\n        useEffect(() => {\n            temptarget.addEventListener(eventname, eventhandler);\n            temptarget.dispatchEvent(new Event(eventname));\n            return () => {\n                temptarget.removeEventListener(eventname, eventhandler);\n            };\n        }, []);\n        newobjtoreturn[key] = [\n            state,\n            (newstate: any) => {\n                if (isfunction(newstate)) {\n                    newstate = newstate.call(undefined, state);\n                }\n                if (isinvalidstate(newstate)) {\n                    throw Error(\"invalid state\");\n                }\n                if (!jsondeepequal(newstate, state)) {\n                    simpleglobalstatestore[key] = jsonparsestringify(newstate);\n                    console.log(\"全局状态改变\", simpleglobalstatestore);\n                    temptarget.dispatchEvent(new Event(eventname));\n                }\n            },\n        ];\n    });\n    return newobjtoreturn;\n}\nexport function initGlobalState(jsonobject: { [key: string]: any }) {\n    if (!isplainobject(jsonobject)) {\n        throw Error(\"invalid object\");\n    }\n    const newjsonobj = newobjjson(jsonobject);\n    const newobjtoreturn: { [key: string]: any } = {};\n    Object.keys(newjsonobj).forEach((key) => {\n        if (\"undefined\" === typeof simpleglobalstatestore[key]) {\n            simpleglobalstatestore[key] = newjsonobj[key];\n        }\n        newobjtoreturn[key] = simpleglobalstatestore[key];\n    });\n    console.log(\"全局状态生成\", simpleglobalstatestore);\n    return newobjtoreturn;\n}\n"],"names":["useGlobalStore","name","jsonobject","isplainobject","Error","newjsonobj","newobjjson","newobjtoreturn","Object","keys","forEach","key","eventname","simpleglobalstatestore","initialstate","isinvalidstate","state","setstate","useState","jsonparsestringify","eventhandler","useCallback","newstate","jsondeepequal","useEffect","temptarget","addEventListener","dispatchEvent","Event","removeEventListener","isfunction","call","undefined","useGlobalStoreold","[object Object]","a","changeState","keyname","newvalue","o","JSON","parse","stringify","getGlobalStates","b","EventTarget","obj","TypeError","prototype","toString","initGlobalState"],"mappings":"0EACgBA,EAAeC,GAC3B,OAyDJ,SAA2BC,GAGvB,IAAKC,EAAcD,GACf,MAAME,MAAM,kBAEhB,MAAMC,EAAaC,EAAWJ,GACxBK,EAAqD,GA2C3D,OA1CAC,OAAOC,KAAKJ,GAAYK,QAASC,IAC7B,MAAMC,EAAYD,OACd,IAAuBE,EAAuBF,KAC9CE,EAAuBF,GAAON,EAAWM,IAE7C,MAAMG,OACF,IAAuBD,EAAuBF,GACxCE,EAAuBF,GACvBN,EAAWM,GACrB,GAAII,EAAeD,GACf,MAAMV,MAAM,iBAEhB,MAAOY,EAAOC,GAAYC,EAASC,EAAmBL,IAChDM,EAAeC,EAAY,KAC7B,MAAMC,EAAWT,EAAuBF,GACnCY,EAAcD,EAAUN,IACzBC,EAASE,EAAmBG,KACjC,IACHE,EAAU,KACNC,EAAWC,iBAAiBd,EAAWQ,GACvCK,EAAWE,cAAc,IAAIC,MAAMhB,IAC5B,KACHa,EAAWI,oBAAoBjB,EAAWQ,KAE/C,IACHb,EAAeI,GAAO,CAClBK,EACCM,IAIG,GAHIQ,EAAWR,KACXA,EAAWA,EAASS,UAAKC,EAAWhB,IAEpCD,EAAeO,GACf,MAAMlB,MAAM,iBAEXmB,EAAcD,EAAUN,KACzBH,EAAuBF,GAAOQ,EAAmBG,GAEjDG,EAAWE,cAAc,IAAIC,MAAMhB,SAK5CL,EA3GA0B,CAAkB,CAAEC,CAACjC,GAAO,KAAMA,GAG7C,SAAS6B,EAAWK,GAChB,MAAO,mBAAsBA,WAEjBC,EAAYC,EAAiBC,GACzC,MAAM3B,EAAM0B,EACNzB,EAAYD,EAClB,IAAIW,EAAWgB,EACf,MACMtB,EADWH,EAAuBF,GAKxC,GAHImB,EAAWR,KACXA,EAAWA,EAASS,UAAKC,EAAWhB,IAEpCD,EAAeO,GACf,MAAMlB,MAAM,iBAEXmB,EAAcD,EAAUN,KACzBH,EAAuBF,GAAOQ,EAAmBG,GAEjDG,EAAWE,cAAc,IAAIC,MAAMhB,KAI3C,SAASO,EAAmBoB,GACxB,OAAOC,KAAKC,MAAMD,KAAKE,UAAUH,aAErBI,EAAgB1C,GAC5B,OAAOK,EAAWO,GAAwBZ,GAG9C,SAASsB,EAAcY,EAAQS,GAC3B,OAAOJ,KAAKE,UAAUP,KAAOK,KAAKE,UAAUE,GAEhD,SAAS7B,EAAeO,GACpB,YACI,IAAuBA,GACvBQ,EAAWR,IACE,OAAbA,GACA,iBAAoBA,EAG5B,MAAMG,EAAa,IAAIoB,YACjBhC,EAAiD,GACvD,SAASP,EAAWwC,GAChB,GAAmB,iBAARA,EACP,MAAM,IAAIC,UAAU,oDAExB,OAAO5B,EAAmB2B,GAE9B,SAAS3C,EAAcoC,GACnB,MACiB,iBAANA,GAC+B,oBAAtC/B,OAAOwC,UAAUC,SAASlB,KAAKQ,YAuDvBW,EAAgBhD,GAC5B,IAAKC,EAAcD,GACf,MAAME,MAAM,kBAEhB,MAAMC,EAAaC,EAAWJ,GACxBK,EAAyC,GAQ/C,OAPAC,OAAOC,KAAKJ,GAAYK,QAASC,SACzB,IAAuBE,EAAuBF,KAC9CE,EAAuBF,GAAON,EAAWM,IAE7CJ,EAAeI,GAAOE,EAAuBF,KAG1CJ"}